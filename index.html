<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소상공인 종합지원을 위한 자가진단 (Real AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .print-only {
            display: none;
        }

        /* [중요] 통합버전18의 인쇄 설정 100% 원복 (입력 페이지 인쇄 보존용) */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: inline !important;
            }

            .screen-only {
                display: none !important;
            }

            body {
                padding: 0 !important;
                background: white !important;
                font-size: 8.5pt !important;
                line-height: 1.15 !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
                align-items: center !important;
                height: 297mm !important;
                width: 210mm !important;
                margin: 0 !important;
            }

            .print-container {
                box-shadow: none !important;
                border: 2pt solid #000 !important;
                width: 190mm !important;
                margin: 0 auto !important;
                padding: 0 !important;
                border-radius: 0 !important;
                background: white !important;
                display: flex;
                flex-direction: column;
                transform: translateY(10mm) !important;
                box-sizing: border-box !important;
            }

            /* 리포트 화면 전용 인쇄 스타일 (입력화면에는 적용 안됨) */
            .report-view {
                transform: none !important;
                margin-top: 5mm !important;
                max-height: 280mm !important;
                overflow: hidden !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
            }

            /* 리포트 부모 컨테이너 */
            .min-h-screen:has(.report-view),
            div:has(> .report-view) {
                max-height: 297mm !important;
                overflow: hidden !important;
            }

            .p-10 {
                padding: 0.5rem 1rem !important;
            }

            h1 {
                font-size: 16pt !important;
                margin-bottom: 0.05rem !important;
            }

            .text-sm {
                font-size: 7.5pt !important;
            }

            .text-xl {
                font-size: 10.5pt !important;
            }

            .p-10.space-y-12 {
                padding: 0.6rem 1.2rem !important;
            }

            .space-y-12>*+* {
                margin-top: 1.1rem !important;
            }

            h2 {
                font-size: 10.5pt !important;
                margin-bottom: 0 !important;
            }

            .mb-6,
            .mb-4 {
                margin-bottom: 0.3rem !important;
            }

            .w-1.5.h-6 {
                height: 1rem !important;
                width: 4px !important;
            }

            .info-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 0.6rem !important;
            }

            .info-grid label {
                font-size: 8pt !important;
            }

            .info-grid select,
            .info-grid input {
                padding: 0.2rem 0.4rem !important;
                font-size: 8.5pt !important;
                height: 26px !important;
                border: 0.5pt solid #ccc !important;
            }

            .revenue-box {
                margin-top: 0.5rem !important;
                padding: 0.4rem !important;
                gap: 1rem !important;
            }

            .revenue-box span {
                font-size: 8.5pt !important;
            }

            .legend-box {
                padding: 0.2rem 0.5rem !important;
                margin-bottom: 0.25rem !important;
                border: 0.5pt solid #e2e8f0 !important;
                line-height: 0.85 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0.05rem !important;
            }

            .legend-box span {
                font-size: 8pt !important;
            }

            .legend-box div.w-full {
                margin-bottom: 0 !important;
            }

            table th,
            table td {
                padding: 0.4rem 0.4rem !important;
                font-size: 9pt !important;
                border: 0.5pt solid #eee !important;
            }

            .text-center-print {
                text-align: center !important;
            }

            .w-9.h-9 {
                width: 1.2rem !important;
                height: 1.2rem !important;
                font-size: 8pt !important;
            }

            .bottom-grid {
                display: grid !important;
                grid-template-columns: 1.1fr 0.9fr !important;
                gap: 1.2rem !important;
                align-items: stretch !important;
            }

            .benefit-grid {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 0.35rem !important;
                width: 100% !important;
            }

            .benefit-grid label {
                padding: 0.3rem 0.5rem !important;
                border: 0.5pt solid #eee !important;
                font-size: 8pt !important;
                height: 32px !important;
                display: flex !important;
                align-items: center;
                width: 100% !important;
                box-sizing: border-box !important;
                margin: 0 !important;
            }

            .notes-area {
                min-height: 132px !important;
                height: 100% !important;
                font-size: 9pt !important;
                padding: 0.5rem !important;
                border: 0.5pt solid #ccc !important;
                box-sizing: border-box !important;
            }

            /* --- [추가] 리포트 결과 화면 전용 스타일 --- */
            /* 입력 페이지 스타일은 건드리지 않고, 리포트 모드일 때만 적용되는 스타일입니다 */
            .report-view {
                display: block !important;
                border: none !important;
                box-shadow: none !important;
                margin-top: 0 !important;
                max-height: 270mm !important;
                /* A4 높이 제한 (여백 고려) */
                overflow: hidden !important;
                /* 넘치는 내용 숨김 */
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
            }

            /* 기본정보 요약 그리드 (Compact) */
            .report-info-container {
                border: 1pt solid #ccc !important;
                background-color: #f8fafc !important;
                padding: 3mm !important;
                margin-bottom: 4mm !important;
                border-radius: 4px !important;
            }

            .report-info-grid {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 2mm !important;
                row-gap: 2mm !important;
            }

            .report-info-item {
                display: flex !important;
                flex-direction: column !important;
            }

            .report-info-label {
                font-size: 7pt !important;
                color: #64748b !important;
                margin-bottom: 0 !important;
                font-weight: bold !important;
            }

            .report-info-value {
                font-size: 9pt !important;
                font-weight: 800 !important;
                color: #000 !important;
            }

            /* AI 텍스트 (1800자가 A4 1페이지를 꽉 채우도록 조정) */
            .ai-text-line {
                font-size: 9.5pt !important;
                line-height: 1.5 !important;
                margin-bottom: 0.5mm !important;
                text-align: justify !important;
            }

            .ai-text-header {
                font-size: 10.5pt !important;
                font-weight: 900 !important;
                margin-top: 3mm !important;
                margin-bottom: 1.2mm !important;
                color: #000 !important;
                border-bottom: 0.5px dashed #bbb;
                display: block;
            }

            .ai-text-bold {
                font-weight: 800 !important;
            }
        }
    </style>
</head>

<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const currentYear = new Date().getFullYear();
            const years = Array.from({ length: 100 }, (_, i) => currentYear - i);

            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
            const [viewMode, setViewMode] = useState('form');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisStatus, setAnalysisStatus] = useState('');
            const [aiResponse, setAiResponse] = useState('');

            useEffect(() => { localStorage.setItem('gemini_api_key', apiKey); }, [apiKey]);

            const [formData, setFormData] = useState({
                birthYear: '', niceScore: '', guaranteedAmount: '', foundationDate: '', sector: '', employeeCount: '', revenueStatus: '', notes: '',
                benefits: { jobIncrease: false, jobCreation: false, intellectualProperty: false, socialInsurance: false, lowIncome: false, socialCare: false, smallBusiness: false, revenueDecrease: false },
                scores: Array(11).fill(0)
            });

            const categories = [{ name: "홍보·마케팅", startIdx: 0, count: 4 }, { name: "매장 운영·관리", startIdx: 4, count: 4 }, { name: "법률·노무·세무", startIdx: 8, count: 3 }];
            const questions = ["우리 동네 상권분석 데이터와 현재 트렌드가 궁금하다.", "쿠폰 발행, 이벤트 기획 등 구체적인 판촉 방법을 알고 싶다.", "인스타그램, 블로그 등 SNS 홍보를 잘하고 싶다.", "배달 앱이나 포털의 리뷰 및 평점 관리 방법을 배우고 싶다.", "고객 트렌드에 맞는 신메뉴나 신상품 개발을 도움받고 싶다.", "분위기 쇄신을 위한 매장 연출(VMD) 개선이 필요하다.", "우리 가게의 로고, 메뉴판 등 디자인을 개선하고 싶다.", "키오스크, 서빙로봇 등 디지털 기술 도입을 희망한다.", "임대료 인상이나 재계약 관련 법률 검토가 필요하다.", "직원 근로계약서, 주휴수당 등 노무 규정 도움이 필요하다.", "부가세, 소득세 신고 시 활용 가능한 절세 팁을 배우고 싶다."];

            // [원복] 통합버전18과 동일한 긴 텍스트 유지
            const benefitOptions = [
                { key: 'jobIncrease', label: '상시근로자 고용 증가' },
                { key: 'jobCreation', label: '일자리 창출(청년, 여성, 고령자, 장애인 고용)' },
                { key: 'intellectualProperty', label: '지식재산권(특허, 실용신안) 보유' },
                { key: 'socialInsurance', label: '사회보험 가입(1인 자영업자 고용보험 포함)' },
                { key: 'lowIncome', label: '저소득(연 59백만원)' },
                { key: 'socialCare', label: '사회적배려(실직자, 장애인, 여성가장, 한부모·다둥이·다문화가정)' },
                { key: 'smallBusiness', label: '영세자영업(간이과세자)' },
                { key: 'revenueDecrease', label: '매출감소(직전 분기·반기 대비 신고매출액 20% 이상 감소)' }
            ];

            const handleScoreChange = (index, score) => { const newScores = [...formData.scores]; newScores[index] = score; setFormData({ ...formData, scores: newScores }); };
            const toggleBenefit = (key) => { setFormData({ ...formData, benefits: { ...formData.benefits, [key]: !formData.benefits[key] } }); };

            // [수정] 텍스트 포매터: 줄간격 최적화 + --- 구분선 제거
            const formatText = (text) => {
                if (!text) return "";
                // 빈 줄 및 --- 구분선 제거하여 세로 폭 절약
                return text.split('\n').filter(line => {
                    const trimmed = line.trim();
                    // 빈 줄, --- 구분선, *** 구분선 제거
                    if (trimmed === '' || trimmed.match(/^[-*=_]{3,}$/)) return false;
                    return true;
                }).map((line, i) => {
                    // 헤더 인식
                    if (line.match(/^(#|\*\*1\.|\*\*2\.|\*\*3\.|\*\*4\.|\*\*5\.)/)) {
                        const cleanLine = line.replace(/#/g, '').replace(/\*\*/g, '').trim();
                        return <div key={i} className="ai-text-header">{cleanLine}</div>;
                    }
                    // 본문
                    const parts = line.split(/(\*\*.*?\*\*)/g);
                    return (
                        <div key={i} className="ai-text-line">
                            {parts.map((part, j) => {
                                if (part.startsWith('**') && part.endsWith('**')) {
                                    return <strong key={j} className="ai-text-bold">{part.slice(2, -2)}</strong>;
                                }
                                return <span key={j}>{part}</span>;
                            })}
                        </div>
                    );
                });
            };

            const runRealAIAnalysis = async () => {
                if (!apiKey) { alert('상단 Safe Connect Mode에 구글 API 키를 먼저 입력해주세요.'); return; }

                setIsAnalyzing(true);
                setAnalysisStatus('AI 서버에 연결 중...');

                const activeBenefits = Object.keys(formData.benefits).filter(k => formData.benefits[k]).map(k => benefitOptions.find(b => b.key === k).label).join(', ');

                // [수정된 프롬프트] 전문 컨설턴트 톤, 객관적/명확한 문어체
                const promptText = `
당신은 서울신용보증재단의 경영컨설팅 전문가입니다. 
제공된 자가진단 데이터와 사장님의 주관식 의견을 바탕으로 전문적이고 정제된 '소상공인 경영 진단 리포트'를 작성하세요.

[핵심 지침]
1. 말투: 지나치게 친근하거나 감성적인 호소는 배제합니다. 전문 컨설턴트로서 신뢰감을 주는 정중하고 명확한 문어체(~함, ~임, ~입니다)를 사용하세요.
2. 분석 우선순위: 섹션 3번 분석 시, 객관식 점수뿐만 아니라 '기타 애로사항(notes)'에 기재된 내용을 최우선으로 반영하여 분석하세요. 사장님의 직접적인 목소리가 가장 시급한 현안입니다.
3. 데이터 해석: 1~4점의 점수를 직접 언급하지 마세요. 대신 "개선 의지가 강력한", "전문적 지원이 시급한", "현안 해결이 우선시되는" 등의 표현을 사용합니다. 이 숫자는 점수가 아닙니다. 합계 등 의미가 없습니다. 1에서 4로 갈수록 더 지원이 필요하다고 느낀다는 의미일 뿐입니다.
4. 서식: 섹션 제목은 반드시 ## **제목** 형식을 사용하세요.

[필수 금지 사항]
1. 리포트 제목, 인사말, 날짜, 서명 등 불필요한 서두와 결미를 생략하고 바로 본론으로 들어갑니다.
2. 구분선(---)이나 불필요한 빈 줄을 사용하지 마세요. (공간 최적화)
3. 전체 분량은 공백 포함 1,800자를 절대 초과할 수 없습니다.

[리포트 구성 및 작성 요령]

## **1. 기본정보 분석** (300자 이내)
- 업종, 출생년도, 신용점수, 기보증금액 등을 바탕으로 사업자의 객관적인 경영 여력을 분석합니다. 특히 신용도와 보증 잔액을 통해 추가 자금 조달의 가능성을 전문가적 시각에서 평가하세요.

## **2. 사업 생애주기 진단** (300자 이내)
- 설립일과 매출 추이를 근거로 현재 사업의 단계(창업기-성장기-성숙기-재도약기)를 정의합니다. 현재 매출 상태가 해당 생애주기에서 갖는 의미를 짚어주세요.

## **3. 중점 지원 필요분야 분석** (400자 이내)
- 자가진단 고득점 항목과 '기타 애로사항'의 주관식 내용을 통합 분석합니다. 단순히 어떤 지원이 필요하다는 식으로 나열하지 마세요.
- 사장님이 겪고 있는 경영적 한계의 본질이 무엇인지 진단하세요. (예: "주관식 의견에 기술된 임대료 부담과 매출 정체는 단순 마케팅 문제가 아닌 수익 구조의 근본적 체질 개선이 필요한 신호임")

## **4. 맞춤형 지원사업 매칭** (500자 이내)
- [금융]: NICE 점수와 기보증 상황에 최적화된 서울시 정책자금(중소기업육성자금, 특별보증 등)을 구체적으로 매칭하세요. 
- [비금융]: 3번 항목에서 도출된 문제를 해결할 '자영업 클리닉', '현장 컨설팅', '전문가 멘토링' 등을 연결하세요.
- 형식: [금융]... (내용) / [비금융]... (내용) 형태로 작성하되 섹션 내 줄바꿈을 최소화하세요.

## **5. 종합 정리** (300자 이내)
- 전체 진단을 종합하여 경영 효율화 및 리스크 관리를 위한 핵심 제언을 기술하세요. 감성적 위로보다는 전문가로서의 실천적 대안(One-Point Lesson)을 제시하며 마무리합니다.

[상담 데이터]
- 업종: ${formData.sector} / 설립일: ${formData.foundationDate}
- NICE: ${formData.niceScore}점 / 기보증: ${formData.guaranteedAmount}만원 / 매출: ${formData.revenueStatus}
- 우대사항: ${activeBenefits}
- 자가진단 니즈 점수(11개 항목): ${JSON.stringify(formData.scores)}
- 기타 애로사항(중요): ${formData.notes || '내용 없음'}
`;

                try {
                    const listResp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    const listData = await listResp.json();
                    if (listData.error) throw new Error(listData.error.message);

                    // 모델 목록에서 최적 모델 찾기
                    const generativeModels = listData.models.filter(m => m.supportedGenerationMethods.includes('generateContent') && !m.name.includes('embedding') && !m.name.includes('aqa'));
                    const bestModel = generativeModels.find(m => m.name.includes('gemini-1.5-flash')) || generativeModels[0];

                    setAnalysisStatus(`${bestModel.name.split('/')[1]} 모델이 리포트 작성 중...`);

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/${bestModel.name}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
                    });

                    const data = await response.json();
                    console.log('API 응답:', data); // 디버깅용
                    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                        setAiResponse(data.candidates[0].content.parts[0].text);
                        setViewMode('report');
                        window.scrollTo(0, 0);
                    } else {
                        console.error('응답 오류:', data);
                        throw new Error(`분석 결과가 비어있습니다. 상세: ${JSON.stringify(data.error || data.promptFeedback || '알 수 없음')}`);
                    }
                } catch (error) { alert(`오류 발생: ${error.message}`); }
                finally { setIsAnalyzing(false); setAnalysisStatus(''); }
            };

            const ReportView = () => (
                <div className="max-w-4xl mx-auto my-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
                    <div className="bg-white p-12 shadow-xl border border-slate-200 rounded-sm print-container report-view">
                        <div className="border-b-4 border-slate-900 pb-4 mb-6">
                            <h1 className="text-3xl font-black text-slate-900 tracking-tight">소상공인 지원 전문가 진단 리포트</h1>
                            <p className="text-sm text-slate-500 font-bold mt-2">AI-Powered Analysis by Seoul Credit Guarantee Foundation</p>
                        </div>

                        {/* [수정] 칭찬해주신 '기본정보 요약 그리드' 적용 */}
                        <div className="mb-6 report-info-container bg-slate-50 rounded-lg border border-slate-200 p-4">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider border-b border-slate-200 pb-1">기본정보 요약</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 report-info-grid">
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">업종</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.sector || "-"}</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">출생년도</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.birthYear || "-"}년</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">NICE 점수</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.niceScore || "0"}점</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">기보증금액</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.guaranteedAmount || "0"}만원</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">설립일자</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.foundationDate || "-"}</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">종업원수</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.employeeCount || "0"}명</span></div>
                                <div className="report-info-item col-span-2"><span className="text-xs text-slate-500 block report-info-label">매출현황</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.revenueStatus || "-"}</span></div>
                            </div>
                        </div>

                        {/* [수정] 줄간격 축소된 AI 본문 */}
                        <div className="space-y-4 text-slate-700 leading-relaxed text-sm md:text-base">
                            {formatText(aiResponse)}
                        </div>

                        <div className="mt-8 pt-6 border-t flex justify-center gap-4 no-print">
                            <button onClick={() => setViewMode('form')} className="px-8 py-3 bg-slate-800 text-white rounded-full font-black hover:bg-slate-700 flex items-center gap-2"><Icon name="rotate-ccw" size={18} /> 다시 진단하기</button>
                            <button onClick={() => window.print()} className="px-8 py-3 border-2 border-slate-800 text-slate-800 rounded-full font-black hover:bg-slate-50 transition-all">
                                리포트 인쇄
                            </button>
                        </div>
                    </div>
                </div>
            );

            if (viewMode === 'report') return <div className="min-h-screen py-8 px-4 bg-slate-100"><ReportView /></div>;

            return (
                <div className="min-h-screen py-8 px-4 relative">
                    <div className="max-w-5xl mx-auto mb-4 no-print flex justify-end items-center gap-2">
                        <div className="bg-slate-800 text-white text-xs px-3 py-1.5 rounded-full flex items-center gap-2 shadow-lg">
                            <Icon name="shield-check" size={14} className="text-emerald-400" />
                            <span className="font-bold">Safe Connect Mode</span>
                            <div className="w-[1px] h-3 bg-slate-600 mx-1"></div>
                            <input
                                type="password" placeholder="Google API Key 입력"
                                className="bg-transparent border-none outline-none text-white placeholder-slate-400 w-32 focus:w-64 transition-all"
                                value={apiKey} onChange={(e) => setApiKey(e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="max-w-5xl mx-auto bg-white shadow-2xl border border-slate-200 overflow-hidden print-container rounded-sm">
                        <div className="p-10 border-b border-slate-100 bg-white relative">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xs font-bold text-slate-400 tracking-tighter uppercase italic">Seoul Credit Guarantee Foundation</span>
                                    </div>
                                    <h1 className="text-4xl font-black text-slate-900 tracking-tight leading-none mb-2">소상공인 종합지원을 위한 자가진단</h1>
                                    <p className="text-sm text-slate-500 font-medium">우리 가게 맞춤형 지원사업 매칭을 위한 기초 리포트</p>
                                </div>
                                <div className="text-right"><p className="text-xl font-black text-[#0055A5] leading-tight mb-1">내일을 꿈꾸는 사장님께</p><p className="text-sm font-bold text-slate-400">서울신용보증재단</p></div>
                            </div>
                        </div>

                        <div className="p-10 space-y-12">
                            {/* [중요] 기존 통합버전18의 입력폼 코드 100% 동일하게 유지 (인쇄 레이아웃 포함) */}
                            <section>
                                <div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">1. 기본정보(대표자, 사업체)</h2></div>
                                <div className="info-grid grid grid-cols-1 md:grid-cols-3 gap-y-5 gap-x-8">
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">출생년도</label><select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.birthYear} onChange={(e) => setFormData({ ...formData, birthYear: e.target.value })}><option value="">년도 선택</option>{years.map(y => <option key={y} value={y}>{y}년</option>)}</select></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">NICE CB점수</label><input type="number" placeholder="점수 입력" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.niceScore} onChange={(e) => setFormData({ ...formData, niceScore: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">기보증금액 (만원)</label><input type="number" placeholder="금액 입력" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.guaranteedAmount} onChange={(e) => setFormData({ ...formData, guaranteedAmount: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">설립일자</label><input type="date" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.foundationDate} onChange={(e) => setFormData({ ...formData, foundationDate: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">업종</label><input type="text" placeholder="업종 입력" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.sector} onChange={(e) => setFormData({ ...formData, sector: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">종업원수 (명)</label><input type="number" placeholder="인원 수" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.employeeCount} onChange={(e) => setFormData({ ...formData, employeeCount: e.target.value })} /></div>
                                </div>
                                <div className="revenue-box mt-8 flex flex-wrap items-center gap-6 p-5 bg-slate-50 rounded-sm border border-slate-100">
                                    <span className="text-xs font-black text-slate-500 uppercase tracking-tighter">매출현황 :</span>
                                    {["지속적인 감소", "감소 후 정체", "현상유지", "증가 후 정체", "지속적인 증가"].map((opt) => (
                                        <label key={opt} className="flex items-center gap-2.5 cursor-pointer group"><input type="radio" name="revenue" className="w-5 h-5 accent-[#0055A5]" checked={formData.revenueStatus === opt} onChange={() => setFormData({ ...formData, revenueStatus: opt })} /><span className={`text-sm font-bold ${formData.revenueStatus === opt ? 'text-[#0055A5]' : 'text-slate-500'}`}>{opt}</span></label>
                                    ))}
                                </div>
                            </section>

                            <section>
                                <div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">2. 사업운영 주요 현황</h2></div>
                                <div className="legend-box mb-5 flex flex-wrap gap-5 bg-blue-50/50 p-4 border border-blue-100/50 rounded-sm shadow-sm"><div className="w-full no-print-bg"><span className="text-xs font-black text-[#0055A5] uppercase tracking-widest underline decoration-blue-200 underline-offset-4">진단 지표 척도 안내 (1~4점)</span></div><div className="flex gap-6"><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">1:</b> 전혀 그렇지 않다</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">2:</b> 그렇지 않다</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">3:</b> 그렇다</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">4:</b> 매우 그렇다</span></div></div>
                                <div className="overflow-x-auto border-t-2 border-slate-800">
                                    <table className="w-full border-collapse">
                                        <thead><tr className="bg-slate-50 text-xs font-black text-slate-500 border-b border-slate-200"><th className="p-4 text-center w-28 text-center-print">구분</th><th className="p-4 text-center text-center-print">진단문항</th> {[1, 2, 3, 4].map(n => <th key={n} className="p-4 text-center w-16">{n}</th>)}</tr></thead>
                                        <tbody>
                                            {categories.map((cat) => (
                                                <React.Fragment key={cat.name}>
                                                    {questions.slice(cat.startIdx, cat.startIdx + cat.count).map((q, qIdx) => (
                                                        <tr key={q} className="border-b border-slate-100 hover:bg-slate-50/30 transition-colors">
                                                            {qIdx === 0 && (<td rowSpan={cat.count} className="p-4 align-middle font-black text-sm text-[#0055A5] border-r border-slate-100 bg-slate-50/20 text-center text-center-print whitespace-pre-wrap">{cat.name === "매장 운영·관리" ? <span>매장 운영·<br className="screen-only" />관리</span> : cat.name === "법률·노무·세무" ? <span>법률·노무·<br className="screen-only" />세무</span> : cat.name}</td>)}
                                                            <td className="p-4 text-base text-slate-700 font-medium leading-snug text-center-print">{q}</td>
                                                            {[1, 2, 3, 4].map(score => (<td key={score} className="p-4 text-center"><button onClick={() => handleScoreChange(cat.startIdx + qIdx, score)} className={`w-9 h-9 rounded-sm border transition-all text-sm font-black ${formData.scores[cat.startIdx + qIdx] === score ? 'bg-[#0055A5] border-[#0055A5] text-white shadow-md' : 'bg-white border-slate-200 text-slate-300 hover:border-slate-400 hover:text-slate-500'}`}>{score}</button></td>))}
                                                        </tr>
                                                    ))}
                                                </React.Fragment>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </section>

                            <div className="bottom-grid grid grid-cols-1 md:grid-cols-2 gap-10 items-stretch">
                                <section className="flex flex-col"><div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">3. 우대사항 체크</h2></div><div className="benefit-grid space-y-1.5">{benefitOptions.map(item => (<label key={item.key} className={`flex items-start gap-3 px-4 py-2.5 rounded-sm border transition-all cursor-pointer group ${formData.benefits[item.key] ? 'bg-blue-50 border-blue-200' : 'bg-white border-slate-100 hover:bg-slate-50'}`}><input type="checkbox" className="mt-0.5 w-5 h-5 accent-[#0055A5]" checked={formData.benefits[item.key]} onChange={() => toggleBenefit(item.key)} /><span className="text-sm font-bold leading-tight group-hover:text-slate-900 transition-colors"><span className={`${formData.benefits[item.key] ? 'text-[#0055A5]' : 'text-slate-600'} screen-only`}>{item.label}</span><span className={`${formData.benefits[item.key] ? 'text-[#0055A5]' : 'text-slate-600'} print-only`}>{item.label.split('(')[0].trim()}</span></span></label>))}</div></section>
                                <section className="flex flex-col"><div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">※ 기타 애로사항</h2></div><textarea className="notes-area w-full flex-grow p-5 border border-slate-200 rounded-sm text-base bg-slate-50/50 focus:ring-1 focus:ring-[#0055A5] outline-none resize-none font-medium leading-relaxed placeholder:text-slate-300" placeholder="구체적인 고민이나 지원이 시급한 내용을 자유롭게 기록하세요." value={formData.notes} onChange={(e) => setFormData({ ...formData, notes: e.target.value })} /></section>
                            </div>

                            <div className="flex justify-between items-center pt-10 border-t border-slate-200 no-print">
                                <button onClick={() => setFormData({ ...formData, scores: Array(11).fill(0), notes: '', benefits: Object.fromEntries(Object.keys(formData.benefits).map(k => [k, false])) })} className="flex items-center gap-2 text-slate-400 hover:text-red-500 font-black text-sm transition-colors"><Icon name="rotate-ccw" size={16} /> 리셋하기</button>
                                <div className="flex gap-4">
                                    <button onClick={runRealAIAnalysis} disabled={isAnalyzing} className={`flex items-center gap-3 px-8 py-4 bg-emerald-600 text-white rounded-sm font-black shadow-xl hover:bg-emerald-700 transition-all text-lg ${isAnalyzing ? 'opacity-50' : ''}`}><Icon name={isAnalyzing ? "loader-2" : "sparkles"} size={22} className={isAnalyzing ? "animate-spin" : ""} />{isAnalyzing ? analysisStatus : "AI 진단 시작"}</button>
                                    <button onClick={() => window.print()} className="flex items-center gap-3 px-10 py-4 bg-[#0055A5] text-white rounded-sm font-black shadow-xl hover:bg-[#004488] transition-all transform active:scale-95 text-lg"><Icon name="printer" size={22} /> 진단 리포트 인쇄</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>