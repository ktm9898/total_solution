<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œìƒê³µì¸ ì¢…í•©ì§€ì›ì„ ìœ„í•œ ìê°€ì§„ë‹¨ (Real AI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .print-only {
            display: none;
        }

        /* í™”ë©´ìš© AI í…ìŠ¤íŠ¸ í—¤ë” ìŠ¤íƒ€ì¼ */
        .ai-text-header {
            font-size: 1.1rem;
            font-weight: 900;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #1e293b;
            border-bottom: 1px dashed #cbd5e1;
            padding-bottom: 0.25rem;
        }

        /* [ì¤‘ìš”] í†µí•©ë²„ì „18ì˜ ì¸ì‡„ ì„¤ì • 100% ì›ë³µ (ì…ë ¥ í˜ì´ì§€ ì¸ì‡„ ë³´ì¡´ìš©) */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            .no-print {
                display: none !important;
            }

            .print-only {
                display: inline !important;
            }

            .screen-only {
                display: none !important;
            }

            body {
                padding: 0 !important;
                background: white !important;
                font-size: 8.5pt !important;
                line-height: 1.15 !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
                align-items: center !important;
                height: 297mm !important;
                width: 210mm !important;
                margin: 0 !important;
            }

            .print-container {
                box-shadow: none !important;
                border: 2pt solid #000 !important;
                width: 190mm !important;
                margin: 0 auto !important;
                padding: 0 !important;
                border-radius: 0 !important;
                background: white !important;
                display: flex;
                flex-direction: column;
                transform: translateY(10mm) !important;
                box-sizing: border-box !important;
            }

            /* ë¦¬í¬íŠ¸ í™”ë©´ ì „ìš© ì¸ì‡„ ìŠ¤íƒ€ì¼ (ì…ë ¥í™”ë©´ì—ëŠ” ì ìš© ì•ˆë¨) */
            .report-view {
                transform: none !important;
                margin-top: 5mm !important;
                max-height: 280mm !important;
                overflow: hidden !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
            }

            /* ë¦¬í¬íŠ¸ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ */
            .min-h-screen:has(.report-view),
            div:has(> .report-view) {
                max-height: 297mm !important;
                overflow: hidden !important;
            }

            .p-10 {
                padding: 0.5rem 1rem !important;
            }

            h1 {
                font-size: 16pt !important;
                margin-bottom: 0.05rem !important;
            }

            .text-sm {
                font-size: 7.5pt !important;
            }

            .text-xl {
                font-size: 10.5pt !important;
            }

            .p-10.space-y-12 {
                padding: 0.6rem 1.2rem !important;
            }

            .space-y-12>*+* {
                margin-top: 1.1rem !important;
            }

            h2 {
                font-size: 10.5pt !important;
                margin-bottom: 0 !important;
            }

            .mb-6,
            .mb-4 {
                margin-bottom: 0.3rem !important;
            }

            .w-1.5.h-6 {
                height: 1rem !important;
                width: 4px !important;
            }

            .info-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 0.6rem !important;
            }

            .info-grid label {
                font-size: 8pt !important;
            }

            .info-grid select,
            .info-grid input {
                padding: 0.2rem 0.4rem !important;
                font-size: 8.5pt !important;
                height: 26px !important;
                border: 0.5pt solid #ccc !important;
            }

            .revenue-box {
                margin-top: 0.5rem !important;
                padding: 0.4rem 0.8rem !important;
                gap: 0.6rem !important;
                flex-wrap: nowrap !important;
                justify-content: space-between !important;
            }

            .revenue-box span {
                font-size: 7.5pt !important;
            }

            .revenue-box input {
                width: 70px !important;
                padding: 0.2rem 0.3rem !important;
                font-size: 7.5pt !important;
            }

            .revenue-box label {
                gap: 0.2rem !important;
            }

            .revenue-box input[type="radio"] {
                width: 12px !important;
                height: 12px !important;
            }

            .legend-box {
                padding: 0.2rem 0.5rem !important;
                margin-bottom: 0.25rem !important;
                border: 0.5pt solid #e2e8f0 !important;
                line-height: 0.85 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 0.05rem !important;
            }

            .legend-box span {
                font-size: 8pt !important;
            }

            .legend-box div.w-full {
                margin-bottom: 0 !important;
            }

            table th,
            table td {
                padding: 0.4rem 0.4rem !important;
                font-size: 9pt !important;
                border: 0.5pt solid #eee !important;
            }

            .text-center-print {
                text-align: center !important;
            }

            .w-9.h-9 {
                width: 1.2rem !important;
                height: 1.2rem !important;
                font-size: 8pt !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .bottom-grid {
                display: grid !important;
                grid-template-columns: 1.1fr 0.9fr !important;
                gap: 1.2rem !important;
                align-items: stretch !important;
            }

            .benefit-grid {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 0.35rem !important;
                width: 100% !important;
            }

            .benefit-grid label {
                padding: 0.3rem 0.5rem !important;
                border: 0.5pt solid #eee !important;
                font-size: 8pt !important;
                height: 32px !important;
                display: flex !important;
                align-items: center;
                width: 100% !important;
                box-sizing: border-box !important;
                margin: 0 !important;
            }

            .notes-area {
                min-height: 132px !important;
                height: 100% !important;
                font-size: 9pt !important;
                padding: 0.5rem !important;
                border: 0.5pt solid #ccc !important;
                box-sizing: border-box !important;
            }

            /* --- [ì¶”ê°€] ë¦¬í¬íŠ¸ ê²°ê³¼ í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼ --- */
            /* ì…ë ¥ í˜ì´ì§€ ìŠ¤íƒ€ì¼ì€ ê±´ë“œë¦¬ì§€ ì•Šê³ , ë¦¬í¬íŠ¸ ëª¨ë“œì¼ ë•Œë§Œ ì ìš©ë˜ëŠ” ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤ */
            .report-view {
                display: block !important;
                border: none !important;
                box-shadow: none !important;
                margin-top: 0 !important;
                max-height: 270mm !important;
                /* A4 ë†’ì´ ì œí•œ (ì—¬ë°± ê³ ë ¤) */
                overflow: hidden !important;
                /* ë„˜ì¹˜ëŠ” ë‚´ìš© ìˆ¨ê¹€ */
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
            }

            /* ê¸°ë³¸ì •ë³´ ìš”ì•½ ê·¸ë¦¬ë“œ (Compact) */
            .report-info-container {
                border: 1pt solid #ccc !important;
                background-color: #f8fafc !important;
                padding: 3mm !important;
                margin-bottom: 4mm !important;
                border-radius: 4px !important;
            }

            .report-info-grid {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 2mm !important;
                row-gap: 2mm !important;
            }

            .report-info-item {
                display: flex !important;
                flex-direction: column !important;
            }

            .report-info-label {
                font-size: 7pt !important;
                color: #64748b !important;
                margin-bottom: 0 !important;
                font-weight: bold !important;
            }

            .report-info-value {
                font-size: 9pt !important;
                font-weight: 800 !important;
                color: #000 !important;
            }

            /* AI í…ìŠ¤íŠ¸ (1800ìê°€ A4 1í˜ì´ì§€ë¥¼ ê½‰ ì±„ìš°ë„ë¡ ì¡°ì •) */
            .ai-text-line {
                font-size: 9.5pt !important;
                line-height: 1.5 !important;
                margin-bottom: 0.5mm !important;
                text-align: justify !important;
            }

            .ai-text-header {
                font-size: 10.5pt !important;
                font-weight: 900 !important;
                margin-top: 3mm !important;
                margin-bottom: 1.2mm !important;
                color: #000 !important;
                border-bottom: 0.5px dashed #bbb;
                display: block;
            }

            .ai-text-bold {
                font-weight: 800 !important;
            }
        }
    </style>
</head>

<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // ========== Google Sheets ì§€ì‹ DB ì„¤ì • ==========
        // [ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ IDì™€ [ë¹„ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ IDë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
        // ì‹œíŠ¸ëŠ” "ê³µê°œ" ë˜ëŠ” "ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìê°€ ë³´ê¸° ê°€ëŠ¥"ìœ¼ë¡œ ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
        // í˜•ì‹: https://docs.google.com/spreadsheets/d/{SHEET_ID}/edit
        const KNOWLEDGE_SHEETS = {
            financial: {
                sheetId: '', // [ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ ID ì…ë ¥
                sheetName: 'Sheet1', // ì‹œíŠ¸ íƒ­ ì´ë¦„
                description: 'ê¸ˆìœµ ì§€ì›ì‚¬ì—…'
            },
            nonFinancial: {
                sheetId: '', // [ë¹„ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ ID ì…ë ¥
                sheetName: 'Sheet1', // ì‹œíŠ¸ íƒ­ ì´ë¦„
                description: 'ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—…'
            }
        };

        // Google Sheets API v4ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (API Key í•„ìš”)
        const fetchSheetData = async (sheetId, sheetName, apiKey) => {
            if (!sheetId || !apiKey) return null;
            try {
                // Google Sheets API v4 endpoint
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'ì‹œíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                const data = await response.json();
                return parseSheetsData(data.values);
            } catch (error) {
                console.warn(`ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨ (${sheetId}):`, error);
                return null;
            }
        };

        // Google Sheets API ì‘ë‹µì„ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜
        const parseSheetsData = (values) => {
            if (!values || values.length < 2) return [];

            const headers = values[0];
            const data = [];
            for (let i = 1; i < values.length; i++) {
                const row = {};
                headers.forEach((header, idx) => {
                    row[header] = values[i][idx] || '';
                });
                data.push(row);
            }
            return data;
        };

        // ì§€ì›ì‚¬ì—… ë°ì´í„°ë¥¼ í”„ë¡¬í”„íŠ¸ìš© í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        const formatKnowledgeForPrompt = (financialData, nonFinancialData) => {
            let knowledgeText = '';

            if (financialData && financialData.length > 0) {
                knowledgeText += '\n\n[ì‚¬ì „ì§€ì‹: ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB]\n';
                knowledgeText += 'ì•„ë˜ëŠ” í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ê¸ˆìœµ ì§€ì›ì‚¬ì—… ëª©ë¡ì…ë‹ˆë‹¤. ê³ ê° ì¡°ê±´ì— ë§ëŠ” ì‚¬ì—…ì„ ë§¤ì¹­í•  ë•Œ ì´ ì •ë³´ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì°¸ê³ í•˜ì„¸ìš”:\n';
                financialData.forEach((row, idx) => {
                    const values = Object.entries(row).map(([k, v]) => `${k}: ${v}`).join(' | ');
                    knowledgeText += `${idx + 1}. ${values}\n`;
                });
            }

            if (nonFinancialData && nonFinancialData.length > 0) {
                knowledgeText += '\n\n[ì‚¬ì „ì§€ì‹: ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB]\n';
                knowledgeText += 'ì•„ë˜ëŠ” í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—…(ì»¨ì„¤íŒ…, êµìœ¡, ë©˜í† ë§ ë“±) ëª©ë¡ì…ë‹ˆë‹¤. ê³ ê°ì˜ ë‹ˆì¦ˆì— ë§ëŠ” ì‚¬ì—…ì„ ë§¤ì¹­í•  ë•Œ ì´ ì •ë³´ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì°¸ê³ í•˜ì„¸ìš”:\n';
                nonFinancialData.forEach((row, idx) => {
                    const values = Object.entries(row).map(([k, v]) => `${k}: ${v}`).join(' | ');
                    knowledgeText += `${idx + 1}. ${values}\n`;
                });
            }

            if (knowledgeText) {
                knowledgeText += '\n[ì¤‘ìš”] ìœ„ ì‚¬ì „ì§€ì‹ DBì— ìˆëŠ” ì§€ì›ì‚¬ì—…ì„ ìš°ì„ ì ìœ¼ë¡œ ì¶”ì²œí•˜ê³ , êµ¬ì²´ì ì¸ ì‚¬ì—…ëª…ê³¼ ë‚´ìš©ì„ ì–¸ê¸‰í•˜ì„¸ìš”. DBì— ì—†ëŠ” ì¼ë°˜ì ì¸ ì •ë³´ëŠ” ë³´ì¡°ì ìœ¼ë¡œë§Œ í™œìš©í•˜ì„¸ìš”.\n';
            }

            return knowledgeText;
        };

        const App = () => {
            const currentYear = new Date().getFullYear();
            const years = Array.from({ length: 100 }, (_, i) => currentYear - i);

            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
            const [viewMode, setViewMode] = useState('form');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisStatus, setAnalysisStatus] = useState('');
            const [aiResponse, setAiResponse] = useState('');

            // Google Sheets ì§€ì‹ DB ìƒíƒœ
            const [sheetConfig, setSheetConfig] = useState({
                financialSheetId: localStorage.getItem('financial_sheet_id') || '',
                nonFinancialSheetId: localStorage.getItem('nonfinancial_sheet_id') || ''
            });
            const [knowledgeData, setKnowledgeData] = useState({ financial: null, nonFinancial: null });
            const [showSheetConfig, setShowSheetConfig] = useState(false);

            // ì‹œíŠ¸ ì„¤ì • ì €ì¥
            useEffect(() => {
                localStorage.setItem('financial_sheet_id', sheetConfig.financialSheetId);
                localStorage.setItem('nonfinancial_sheet_id', sheetConfig.nonFinancialSheetId);
            }, [sheetConfig]);

            useEffect(() => { localStorage.setItem('gemini_api_key', apiKey); }, [apiKey]);

            const [formData, setFormData] = useState({
                birthYear: '', niceScore: '', guaranteedAmount: '', foundationDate: '', sector: '', employeeCount: '', annualSales: '', revenueStatus: '', notes: '',
                benefits: { jobIncrease: false, jobCreation: false, intellectualProperty: false, socialInsurance: false, lowIncome: false, socialCare: false, smallBusiness: false, revenueDecrease: false },
                scores: Array(11).fill(0)
            });

            const categories = [{ name: "í™ë³´Â·ë§ˆì¼€íŒ…", startIdx: 0, count: 4 }, { name: "ë§¤ì¥ ìš´ì˜Â·ê´€ë¦¬", startIdx: 4, count: 4 }, { name: "ë²•ë¥ Â·ë…¸ë¬´Â·ì„¸ë¬´", startIdx: 8, count: 3 }];
            const questions = ["ìš°ë¦¬ ë™ë„¤ ìƒê¶Œë¶„ì„ ë°ì´í„°ì™€ í˜„ì¬ íŠ¸ë Œë“œê°€ ê¶ê¸ˆí•˜ë‹¤.", "ì¿ í° ë°œí–‰, ì´ë²¤íŠ¸ ê¸°íš ë“± êµ¬ì²´ì ì¸ íŒì´‰ ë°©ë²•ì„ ì•Œê³  ì‹¶ë‹¤.", "ì¸ìŠ¤íƒ€ê·¸ë¨, ë¸”ë¡œê·¸ ë“± SNS í™ë³´ë¥¼ ì˜í•˜ê³  ì‹¶ë‹¤.", "ë°°ë‹¬ ì•±ì´ë‚˜ í¬í„¸ì˜ ë¦¬ë·° ë° í‰ì  ê´€ë¦¬ ë°©ë²•ì„ ë°°ìš°ê³  ì‹¶ë‹¤.", "ê³ ê° íŠ¸ë Œë“œì— ë§ëŠ” ì‹ ë©”ë‰´ë‚˜ ì‹ ìƒí’ˆ ê°œë°œì„ ë„ì›€ë°›ê³  ì‹¶ë‹¤.", "ë¶„ìœ„ê¸° ì‡„ì‹ ì„ ìœ„í•œ ë§¤ì¥ ì—°ì¶œ(VMD) ê°œì„ ì´ í•„ìš”í•˜ë‹¤.", "ìš°ë¦¬ ê°€ê²Œì˜ ë¡œê³ , ë©”ë‰´íŒ ë“± ë””ìì¸ì„ ê°œì„ í•˜ê³  ì‹¶ë‹¤.", "í‚¤ì˜¤ìŠ¤í¬, ì„œë¹™ë¡œë´‡ ë“± ë””ì§€í„¸ ê¸°ìˆ  ë„ì…ì„ í¬ë§í•œë‹¤.", "ì„ëŒ€ë£Œ ì¸ìƒì´ë‚˜ ì¬ê³„ì•½ ê´€ë ¨ ë²•ë¥  ê²€í† ê°€ í•„ìš”í•˜ë‹¤.", "ì§ì› ê·¼ë¡œê³„ì•½ì„œ, ì£¼íœ´ìˆ˜ë‹¹ ë“± ë…¸ë¬´ ê·œì • ë„ì›€ì´ í•„ìš”í•˜ë‹¤.", "ë¶€ê°€ì„¸, ì†Œë“ì„¸ ì‹ ê³  ì‹œ í™œìš© ê°€ëŠ¥í•œ ì ˆì„¸ íŒì„ ë°°ìš°ê³  ì‹¶ë‹¤."];

            // [ì›ë³µ] í†µí•©ë²„ì „18ê³¼ ë™ì¼í•œ ê¸´ í…ìŠ¤íŠ¸ ìœ ì§€
            const benefitOptions = [
                { key: 'jobIncrease', label: 'ìƒì‹œê·¼ë¡œì ê³ ìš© ì¦ê°€' },
                { key: 'jobCreation', label: 'ì¼ìë¦¬ ì°½ì¶œ(ì²­ë…„, ì—¬ì„±, ê³ ë ¹ì, ì¥ì• ì¸ ê³ ìš©)' },
                { key: 'intellectualProperty', label: 'ì§€ì‹ì¬ì‚°ê¶Œ(íŠ¹í—ˆ, ì‹¤ìš©ì‹ ì•ˆ) ë³´ìœ ' },
                { key: 'socialInsurance', label: 'ì‚¬íšŒë³´í—˜ ê°€ì…(1ì¸ ìì˜ì—…ì ê³ ìš©ë³´í—˜ í¬í•¨)' },
                { key: 'lowIncome', label: 'ì €ì†Œë“(ì—° 59ë°±ë§Œì› ì´í•˜)' },
                { key: 'socialCare', label: 'ì‚¬íšŒì ë°°ë ¤(ì‹¤ì§ì, ì¥ì• ì¸, ì—¬ì„±ê°€ì¥, í•œë¶€ëª¨Â·ë‹¤ë‘¥ì´Â·ë‹¤ë¬¸í™”ê°€ì •)' },
                { key: 'smallBusiness', label: 'ì˜ì„¸ìì˜ì—…(ê°„ì´ê³¼ì„¸ì)' },
                { key: 'revenueDecrease', label: 'ë§¤ì¶œê°ì†Œ(ì§ì „ ë¶„ê¸°Â·ë°˜ê¸° ëŒ€ë¹„ ì‹ ê³ ë§¤ì¶œì•¡ 20% ì´ìƒ ê°ì†Œ)' }
            ];

            const handleScoreChange = (index, score) => { const newScores = [...formData.scores]; newScores[index] = score; setFormData({ ...formData, scores: newScores }); };
            const toggleBenefit = (key) => { setFormData({ ...formData, benefits: { ...formData.benefits, [key]: !formData.benefits[key] } }); };

            // [ìˆ˜ì •] í…ìŠ¤íŠ¸ í¬ë§¤í„°: ì¤„ê°„ê²© ìµœì í™” + --- êµ¬ë¶„ì„  ì œê±°
            const formatText = (text) => {
                if (!text) return "";
                // ë¹ˆ ì¤„ ë° --- êµ¬ë¶„ì„  ì œê±°í•˜ì—¬ ì„¸ë¡œ í­ ì ˆì•½
                return text.split('\n').filter(line => {
                    const trimmed = line.trim();
                    // ë¹ˆ ì¤„, --- êµ¬ë¶„ì„ , *** êµ¬ë¶„ì„  ì œê±°
                    if (trimmed === '' || trimmed.match(/^[-*=_]{3,}$/)) return false;
                    return true;
                }).map((line, i) => {
                    // í—¤ë” ì¸ì‹ (ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ì œëª© ë˜ëŠ” ## ë“±)
                    if (line.match(/^(##|#|\*\*?\s*[1-5]\.|[1-5]\.)/)) {
                        const cleanLine = line.replace(/^#+\s*/g, '').replace(/\*\*/g, '').trim();
                        return <div key={i} className="ai-text-header">{cleanLine}</div>;
                    }
                    // ë³¸ë¬¸
                    const parts = line.split(/(\*\*.*?\*\*)/g);
                    return (
                        <div key={i} className="ai-text-line">
                            {parts.map((part, j) => {
                                if (part.startsWith('**') && part.endsWith('**')) {
                                    return <strong key={j} className="ai-text-bold">{part.slice(2, -2)}</strong>;
                                }
                                return <span key={j}>{part}</span>;
                            })}
                        </div>
                    );
                });
            };

            const runRealAIAnalysis = async () => {
                if (!apiKey) { alert('ìƒë‹¨ Safe Connect Modeì— êµ¬ê¸€ API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

                setIsAnalyzing(true);
                setAnalysisStatus('ì§€ì‹ DB ë¡œë“œ ì¤‘...');

                // ========== Google Sheets ì§€ì‹ DB ë¡œë“œ ==========
                let financialData = null;
                let nonFinancialData = null;

                if (sheetConfig.financialSheetId) {
                    setAnalysisStatus('ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB ë¡œë“œ ì¤‘...');
                    financialData = await fetchSheetData(sheetConfig.financialSheetId, 'Sheet1', apiKey);
                    console.log('ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB:', financialData);
                }

                if (sheetConfig.nonFinancialSheetId) {
                    setAnalysisStatus('ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB ë¡œë“œ ì¤‘...');
                    nonFinancialData = await fetchSheetData(sheetConfig.nonFinancialSheetId, 'Sheet1', apiKey);
                    console.log('ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB:', nonFinancialData);
                }

                // ì§€ì‹ DBë¥¼ í”„ë¡¬í”„íŠ¸ìš© í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
                const knowledgeText = formatKnowledgeForPrompt(financialData, nonFinancialData);

                setAnalysisStatus('AI ì„œë²„ì— ì—°ê²° ì¤‘...');

                const activeBenefits = Object.keys(formData.benefits).filter(k => formData.benefits[k]).map(k => benefitOptions.find(b => b.key === k).label).join(', ');

                // [ìˆ˜ì •ëœ í”„ë¡¬í”„íŠ¸] ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ í†¤, ê°ê´€ì /ëª…í™•í•œ ë¬¸ì–´ì²´ + ì‚¬ì „ì§€ì‹ DB í¬í•¨
                const promptText = `
ë‹¹ì‹ ì€ ì„œìš¸ì‹ ìš©ë³´ì¦ì¬ë‹¨ì˜ ê²½ì˜ì»¨ì„¤íŒ… ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
ì œê³µëœ ìê°€ì§„ë‹¨ ë°ì´í„°ì™€ ì‚¬ì¥ë‹˜ì˜ ì£¼ê´€ì‹ ì˜ê²¬ì„ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ì •ì œëœ 'ì†Œìƒê³µì¸ ê²½ì˜ ì§„ë‹¨ ë¦¬í¬íŠ¸'ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
${knowledgeText}
[í•µì‹¬ ì§€ì¹¨]
1. ë§íˆ¬: ì§€ë‚˜ì¹˜ê²Œ ì¹œê·¼í•˜ê±°ë‚˜ ê°ì„±ì ì¸ í˜¸ì†ŒëŠ” ë°°ì œí•©ë‹ˆë‹¤. ì „ë¬¸ ì»¨ì„¤í„´íŠ¸ë¡œì„œ ì‹ ë¢°ê°ì„ ì£¼ëŠ” ì •ì¤‘í•˜ê³  ëª…í™•í•œ ë¬¸ì–´ì²´(~í•¨, ~ì„, ~ì…ë‹ˆë‹¤)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
2. ë¶„ì„ ìš°ì„ ìˆœìœ„: ì„¹ì…˜ 3ë²ˆ ë¶„ì„ ì‹œ, ê°ê´€ì‹ ì ìˆ˜ë¿ë§Œ ì•„ë‹ˆë¼ 'ê¸°íƒ€ ì• ë¡œì‚¬í•­(notes)'ì— ê¸°ì¬ëœ ë‚´ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ ë°˜ì˜í•˜ì—¬ ë¶„ì„í•˜ì„¸ìš”. ì‚¬ì¥ë‹˜ì˜ ì§ì ‘ì ì¸ ëª©ì†Œë¦¬ê°€ ê°€ì¥ ì‹œê¸‰í•œ í˜„ì•ˆì…ë‹ˆë‹¤.
3. ë°ì´í„° í•´ì„: 1~4ì ì˜ ì ìˆ˜ë¥¼ ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”. ëŒ€ì‹  "ê°œì„  ì˜ì§€ê°€ ê°•ë ¥í•œ", "ì „ë¬¸ì  ì§€ì›ì´ ì‹œê¸‰í•œ", "í˜„ì•ˆ í•´ê²°ì´ ìš°ì„ ì‹œë˜ëŠ”" ë“±ì˜ í‘œí˜„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ ìˆ«ìëŠ” ì ìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤. í•©ê³„ ë“± ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤. 1ì—ì„œ 4ë¡œ ê°ˆìˆ˜ë¡ ë” ì§€ì›ì´ í•„ìš”í•˜ë‹¤ê³  ëŠë‚€ë‹¤ëŠ” ì˜ë¯¸ì¼ ë¿ì…ë‹ˆë‹¤.
4. ì„œì‹: ì„¹ì…˜ ì œëª©ì€ ë°˜ë“œì‹œ "1. ê¸°ë³¸ì •ë³´ ë¶„ì„", "2. ì‚¬ì—… ìƒì• ì£¼ê¸° ì§„ë‹¨" ì´ëŸ° ì‹ìœ¼ë¡œ ìˆ«ìì™€ ì ìœ¼ë¡œë§Œ ì‹œì‘í•˜ì„¸ìš”. ##ì´ë‚˜ **ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
5. **ì‚¬ì „ì§€ì‹ DB í™œìš©**: ìœ„ì— ì œê³µëœ [ì‚¬ì „ì§€ì‹: ê¸ˆìœµ/ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… DB]ê°€ ìˆë‹¤ë©´, ì„¹ì…˜ 4ë²ˆ ì‘ì„± ì‹œ í•´ë‹¹ DBì˜ êµ¬ì²´ì ì¸ ì‚¬ì—…ëª…ê³¼ ë‚´ìš©ì„ ìµœìš°ì„ ìœ¼ë¡œ ì¸ìš©í•˜ì„¸ìš”.

[í•„ìˆ˜ ê¸ˆì§€ ì‚¬í•­]
1. ë¦¬í¬íŠ¸ ì œëª©, ì¸ì‚¬ë§, ë‚ ì§œ, ì„œëª… ë“± ë¶ˆí•„ìš”í•œ ì„œë‘ì™€ ê²°ë¯¸ë¥¼ ìƒëµí•˜ê³  ë°”ë¡œ ë³¸ë¡ ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.
2. êµ¬ë¶„ì„ (---)ì´ë‚˜ ë¶ˆí•„ìš”í•œ ë¹ˆ ì¤„ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”. (ê³µê°„ ìµœì í™”)
3. **ê¸€ììˆ˜ ì ˆëŒ€ ì¤€ìˆ˜**: ì „ì²´ ë¶„ëŸ‰ì€ ê³µë°± í¬í•¨ ì •í™•íˆ 1,700ìì…ë‹ˆë‹¤. 1,650ì ë¯¸ë§Œì´ë©´ ë„ˆë¬´ ì§§ê³ , 1,750ì ì´ˆê³¼ë©´ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ê° ì„¹ì…˜ë³„ ê¸€ììˆ˜ë¥¼ í•©ì‚°í•˜ë©´ ì •í™•íˆ 1,700ìê°€ ë˜ë„ë¡ ì‘ì„±í•˜ì„¸ìš”.

[ë¦¬í¬íŠ¸ êµ¬ì„± ë° ì‘ì„± ìš”ë ¹]

1. ê¸°ë³¸ì •ë³´ ë¶„ì„ (300ì)
- ì—…ì¢…, ì¶œìƒë…„ë„, ì‹ ìš©ì ìˆ˜, ê¸°ë³´ì¦ê¸ˆì•¡, ì‹ ê³ ë§¤ì¶œì•¡ ë“±ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ì—…ìì˜ ê°ê´€ì ì¸ ê²½ì˜ ì—¬ë ¥ì„ ë¶„ì„í•©ë‹ˆë‹¤.
- **ì¤‘ìš”**: ê¸°ë³´ì¦ê¸ˆì•¡ì€ ì´ë¯¸ ì¬ë‹¨ì˜ ë³´ì¦ í•œë„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì‹ ê³ ë§¤ì¶œì•¡ ëŒ€ë¹„ ê¸°ë³´ì¦ê¸ˆì•¡ì´ ë†’ì„ìˆ˜ë¡ ì¶”ê°€ ë³´ì¦ ì—¬ë ¥ì´ ì œí•œë©ë‹ˆë‹¤(ë§¤ì¶œì•¡ ì´ìƒì€ ì¶”ê°€ ë³´ì¦ ë¶ˆê°€). ì´ ë¹„ìœ¨ì„ ê°ì•ˆí•˜ì—¬ ì¶”ê°€ ìê¸ˆ ì¡°ë‹¬ì˜ ê°€ëŠ¥ì„±ì„ ì „ë¬¸ê°€ì  ì‹œê°ì—ì„œ í‰ê°€í•˜ì„¸ìš”.

2. ì‚¬ì—… ìƒì• ì£¼ê¸° ì§„ë‹¨ (300ì)
- ì„¤ë¦½ì¼ê³¼ ë§¤ì¶œ ì¶”ì´ë¥¼ ê·¼ê±°ë¡œ í˜„ì¬ ì‚¬ì—…ì˜ ë‹¨ê³„(ì°½ì—…ê¸°-ì„±ì¥ê¸°-ì„±ìˆ™ê¸°-ì¬ë„ì•½ê¸°)ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. í˜„ì¬ ë§¤ì¶œ ìƒíƒœê°€ í•´ë‹¹ ìƒì• ì£¼ê¸°ì—ì„œ ê°–ëŠ” ì˜ë¯¸ë¥¼ ì§šì–´ì£¼ì„¸ìš”.

3. ì¤‘ì  ì§€ì› í•„ìš”ë¶„ì•¼ ë¶„ì„ (400ì)
- ìê°€ì§„ë‹¨ ê³ ë“ì  í•­ëª©ê³¼ 'ê¸°íƒ€ ì• ë¡œì‚¬í•­'ì˜ ì£¼ê´€ì‹ ë‚´ìš©ì„ í†µí•© ë¶„ì„í•©ë‹ˆë‹¤. ë‹¨ìˆœíˆ ì–´ë–¤ ì§€ì›ì´ í•„ìš”í•˜ë‹¤ëŠ” ì‹ìœ¼ë¡œ ë‚˜ì—´í•˜ì§€ ë§ˆì„¸ìš”.
- ì‚¬ì¥ë‹˜ì´ ê²ªê³  ìˆëŠ” ê²½ì˜ì  í•œê³„ì˜ ë³¸ì§ˆì´ ë¬´ì—‡ì¸ì§€ ì§„ë‹¨í•˜ì„¸ìš”. (ì˜ˆ: "ì£¼ê´€ì‹ ì˜ê²¬ì— ê¸°ìˆ ëœ ì„ëŒ€ë£Œ ë¶€ë‹´ê³¼ ë§¤ì¶œ ì •ì²´ëŠ” ë‹¨ìˆœ ë§ˆì¼€íŒ… ë¬¸ì œê°€ ì•„ë‹Œ ìˆ˜ìµ êµ¬ì¡°ì˜ ê·¼ë³¸ì  ì²´ì§ˆ ê°œì„ ì´ í•„ìš”í•œ ì‹ í˜¸ì„")

4. ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… ë§¤ì¹­ (500ì)
- [ê¸ˆìœµ]: ìœ„ ì‚¬ì „ì§€ì‹ DBì— ìˆëŠ” ê¸ˆìœµ ì§€ì›ì‚¬ì—… ì¤‘ NICE ì ìˆ˜ì™€ ê¸°ë³´ì¦ ìƒí™©ì— ìµœì í™”ëœ ì‚¬ì—…ì„ êµ¬ì²´ì ì¸ ì‚¬ì—…ëª…ìœ¼ë¡œ ë§¤ì¹­í•˜ì„¸ìš”. 
- [ë¹„ê¸ˆìœµ]: ìœ„ ì‚¬ì „ì§€ì‹ DBì— ìˆëŠ” ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… ì¤‘ 3ë²ˆ í•­ëª©ì—ì„œ ë„ì¶œëœ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ì‚¬ì—…ì„ êµ¬ì²´ì ì¸ ì‚¬ì—…ëª…ìœ¼ë¡œ ì—°ê²°í•˜ì„¸ìš”.
- í˜•ì‹: [ê¸ˆìœµ]ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ë‹¨ê³¼ [ë¹„ê¸ˆìœµ]ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¬¸ë‹¨ì„ ì¤„ë°”ê¿ˆí•˜ì—¬ ë¶„ë¦¬í•˜ì„¸ìš”.
- **ì¤‘ìš”**: ì‚¬ì „ì§€ì‹ DBê°€ ì œê³µëœ ê²½ìš°, ë°˜ë“œì‹œ í•´ë‹¹ DBì˜ ì‚¬ì—…ëª…ì„ ì¸ìš©í•˜ê³  ì¼ë°˜ì ì¸ ì •ë³´ëŠ” ë³´ì¡°ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.

5. ì¢…í•© ì •ë¦¬ (300ì)
- ì „ì²´ ì§„ë‹¨ì„ ì¢…í•©í•˜ì—¬ ê²½ì˜ íš¨ìœ¨í™” ë° ë¦¬ìŠ¤í¬ ê´€ë¦¬ë¥¼ ìœ„í•œ í•µì‹¬ ì œì–¸ì„ ê¸°ìˆ í•˜ì„¸ìš”. ê°ì„±ì  ìœ„ë¡œë³´ë‹¤ëŠ” ì „ë¬¸ê°€ë¡œì„œì˜ ì‹¤ì²œì  ëŒ€ì•ˆ(One-Point Lesson)ì„ ì œì‹œí•˜ë©° ë§ˆë¬´ë¦¬í•©ë‹ˆë‹¤.

[ìƒë‹´ ë°ì´í„°]
- ì—…ì¢…: ${formData.sector} / ì„¤ë¦½ì¼: ${formData.foundationDate}
- NICE: ${formData.niceScore}ì  / ê¸°ë³´ì¦: ${formData.guaranteedAmount}ë§Œì› / ìµœê·¼1ë…„ ì‹ ê³ ë§¤ì¶œì•¡: ${formData.annualSales || 'ë¯¸ì…ë ¥'}ë§Œì› / ë§¤ì¶œì¶”ì´: ${formData.revenueStatus}
- ìš°ëŒ€ì‚¬í•­: ${activeBenefits}
- ìê°€ì§„ë‹¨ ë‹ˆì¦ˆ ì ìˆ˜(11ê°œ í•­ëª©): ${JSON.stringify(formData.scores)}
- ê¸°íƒ€ ì• ë¡œì‚¬í•­(ì¤‘ìš”): ${formData.notes || 'ë‚´ìš© ì—†ìŒ'}
`;

                try {
                    const listResp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                    const listData = await listResp.json();
                    if (listData.error) throw new Error(listData.error.message);

                    // ëª¨ë¸ ëª©ë¡ì—ì„œ ìµœì  ëª¨ë¸ ì°¾ê¸°
                    const generativeModels = listData.models.filter(m => m.supportedGenerationMethods.includes('generateContent') && !m.name.includes('embedding') && !m.name.includes('aqa'));
                    const bestModel = generativeModels.find(m => m.name.includes('gemini-1.5-flash')) || generativeModels[0];

                    setAnalysisStatus(`${bestModel.name.split('/')[1]} ëª¨ë¸ì´ ë¦¬í¬íŠ¸ ì‘ì„± ì¤‘...`);

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/${bestModel.name}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: promptText }] }] })
                    });

                    const data = await response.json();
                    console.log('API ì‘ë‹µ:', data); // ë””ë²„ê¹…ìš©
                    console.log('ì‚¬ìš©ëœ í”„ë¡¬í”„íŠ¸ (ì§€ì‹DB í¬í•¨):', promptText); // ë””ë²„ê¹…ìš©
                    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                        setAiResponse(data.candidates[0].content.parts[0].text);
                        setViewMode('report');
                        window.scrollTo(0, 0);
                    } else {
                        console.error('ì‘ë‹µ ì˜¤ë¥˜:', data);
                        throw new Error(`ë¶„ì„ ê²°ê³¼ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ìƒì„¸: ${JSON.stringify(data.error || data.promptFeedback || 'ì•Œ ìˆ˜ ì—†ìŒ')}`);
                    }
                } catch (error) { alert(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`); }
                finally { setIsAnalyzing(false); setAnalysisStatus(''); }
            };

            const ReportView = () => (
                <div className="max-w-4xl mx-auto my-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
                    <div className="bg-white p-12 shadow-xl border border-slate-200 rounded-sm print-container report-view">
                        <div className="border-b-4 border-slate-900 pb-4 mb-6">
                            <h1 className="text-3xl font-black text-slate-900 tracking-tight">ì†Œìƒê³µì¸ ì§€ì› ì „ë¬¸ê°€ ì§„ë‹¨ ë¦¬í¬íŠ¸</h1>
                            <p className="text-sm text-slate-500 font-bold mt-2">AI-Powered Analysis by Seoul Credit Guarantee Foundation</p>
                        </div>

                        {/* [ìˆ˜ì •] ì¹­ì°¬í•´ì£¼ì‹  'ê¸°ë³¸ì •ë³´ ìš”ì•½ ê·¸ë¦¬ë“œ' ì ìš© */}
                        <div className="mb-6 report-info-container bg-slate-50 rounded-lg border border-slate-200 p-4">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider border-b border-slate-200 pb-1">ê¸°ë³¸ì •ë³´ ìš”ì•½</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 report-info-grid">
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">ì—…ì¢…</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.sector || "-"}</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">ì¶œìƒë…„ë„</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.birthYear || "-"}ë…„</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">NICE ì ìˆ˜</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.niceScore || "0"}ì </span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">ê¸°ë³´ì¦ê¸ˆì•¡</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.guaranteedAmount || "0"}ë§Œì›</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">ì„¤ë¦½ì¼ì</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.foundationDate || "-"}</span></div>
                                <div className="report-info-item"><span className="text-xs text-slate-500 block report-info-label">ì¢…ì—…ì›ìˆ˜</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.employeeCount || "0"}ëª…</span></div>
                                <div className="report-info-item col-span-2"><span className="text-xs text-slate-500 block report-info-label">ë§¤ì¶œí˜„í™©</span><span className="text-sm font-black text-slate-800 report-info-value">{formData.annualSales || "-"}ë§Œì›({formData.revenueStatus || "-"})</span></div>
                            </div>
                        </div>

                        {/* [ìˆ˜ì •] ì¤„ê°„ê²© ì¶•ì†Œëœ AI ë³¸ë¬¸ */}
                        <div className="space-y-4 text-slate-700 leading-relaxed text-sm md:text-base">
                            {formatText(aiResponse)}
                        </div>

                        <div className="mt-8 pt-6 border-t flex justify-center gap-4 no-print">
                            <button onClick={() => setViewMode('form')} className="px-8 py-3 bg-slate-800 text-white rounded-full font-black hover:bg-slate-700 flex items-center gap-2"><Icon name="rotate-ccw" size={18} /> ë‹¤ì‹œ ì§„ë‹¨í•˜ê¸°</button>
                            <button onClick={() => window.print()} className="px-8 py-3 border-2 border-slate-800 text-slate-800 rounded-full font-black hover:bg-slate-50 transition-all">
                                ë¦¬í¬íŠ¸ ì¸ì‡„
                            </button>
                        </div>
                    </div>
                </div>
            );

            if (viewMode === 'report') return <div className="min-h-screen py-8 px-4 bg-slate-100"><ReportView /></div>;

            return (
                <div className="min-h-screen py-8 px-4 relative">
                    <div className="max-w-5xl mx-auto mb-4 no-print flex justify-end items-center gap-2">
                        {/* ì§€ì‹ DB ì„¤ì • ë²„íŠ¼ */}
                        <button
                            onClick={() => setShowSheetConfig(!showSheetConfig)}
                            className={`text-xs px-3 py-1.5 rounded-full flex items-center gap-2 shadow-lg transition-all ${showSheetConfig ? 'bg-amber-500 text-white' : 'bg-slate-700 text-white hover:bg-slate-600'}`}
                        >
                            <Icon name="database" size={14} className={showSheetConfig ? 'text-white' : 'text-amber-400'} />
                            <span className="font-bold">ì§€ì‹ DB</span>
                            {(sheetConfig.financialSheetId || sheetConfig.nonFinancialSheetId) &&
                                <span className="bg-emerald-500 text-white text-[10px] px-1.5 py-0.5 rounded-full font-bold">ON</span>
                            }
                        </button>

                        <div className="bg-slate-800 text-white text-xs px-3 py-1.5 rounded-full flex items-center gap-2 shadow-lg">
                            <Icon name="shield-check" size={14} className="text-emerald-400" />
                            <span className="font-bold">Safe Connect Mode</span>
                            <div className="w-[1px] h-3 bg-slate-600 mx-1"></div>
                            <input
                                type="password" placeholder="Google API Key ì…ë ¥"
                                className="bg-transparent border-none outline-none text-white placeholder-slate-400 w-32 focus:w-64 transition-all"
                                value={apiKey} onChange={(e) => setApiKey(e.target.value)}
                            />
                        </div>
                    </div>

                    {/* ì§€ì‹ DB ì„¤ì • íŒ¨ë„ (í† ê¸€) */}
                    {showSheetConfig && (
                        <div className="max-w-5xl mx-auto mb-4 no-print bg-slate-800 text-white rounded-lg p-4 shadow-xl border border-slate-700">
                            <div className="flex items-center gap-2 mb-3 pb-2 border-b border-slate-600">
                                <Icon name="book-open" size={16} className="text-amber-400" />
                                <span className="font-black text-sm">Google Sheets ì§€ì‹ DB ì„¤ì •</span>
                                <span className="text-xs text-slate-400 ml-2">(ë™ì¼í•œ Google API Key ì‚¬ìš©)</span>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-amber-300">[ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ ID</label>
                                    <input
                                        type="text"
                                        placeholder="ì˜ˆ: 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                                        className="w-full p-2 bg-slate-700 border border-slate-600 rounded text-sm text-white placeholder-slate-500 outline-none focus:border-amber-400"
                                        value={sheetConfig.financialSheetId}
                                        onChange={(e) => setSheetConfig({ ...sheetConfig, financialSheetId: e.target.value })}
                                    />
                                    <p className="text-[10px] text-slate-400">ì‹œíŠ¸ URLì—ì„œ /d/ ì™€ /edit ì‚¬ì´ì˜ IDë¥¼ ë³µì‚¬í•˜ì„¸ìš”</p>
                                </div>
                                <div className="space-y-1">
                                    <label className="text-xs font-bold text-emerald-300">[ë¹„ê¸ˆìœµ] ì§€ì›ì‚¬ì—… ì‹œíŠ¸ ID</label>
                                    <input
                                        type="text"
                                        placeholder="ì˜ˆ: 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                                        className="w-full p-2 bg-slate-700 border border-slate-600 rounded text-sm text-white placeholder-slate-500 outline-none focus:border-emerald-400"
                                        value={sheetConfig.nonFinancialSheetId}
                                        onChange={(e) => setSheetConfig({ ...sheetConfig, nonFinancialSheetId: e.target.value })}
                                    />
                                    <p className="text-[10px] text-slate-400">ì»¨ì„¤íŒ…, êµìœ¡, ë©˜í† ë§ ë“± ë¹„ê¸ˆìœµ ì§€ì›ì‚¬ì—… ëª©ë¡</p>
                                </div>
                            </div>
                            <div className="mt-3 pt-2 border-t border-slate-600 text-xs text-slate-400">
                                <p>ğŸ’¡ <b className="text-white">ì‚¬ìš© ë°©ë²•:</b> Google Cloud Consoleì—ì„œ Sheets APIë¥¼ í™œì„±í™”í•˜ê³ , ì‹œíŠ¸ë¥¼ API Keyë¡œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •í•˜ì„¸ìš”.</p>
                            </div>
                        </div>
                    )}

                    <div className="max-w-5xl mx-auto bg-white shadow-2xl border border-slate-200 overflow-hidden print-container rounded-sm">
                        <div className="p-10 border-b border-slate-100 bg-white relative">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="text-xs font-bold text-slate-400 tracking-tighter uppercase italic">Seoul Credit Guarantee Foundation</span>
                                    </div>
                                    <h1 className="text-4xl font-black text-slate-900 tracking-tight leading-none mb-2">ì†Œìƒê³µì¸ ì¢…í•©ì§€ì›ì„ ìœ„í•œ ìê°€ì§„ë‹¨</h1>
                                    <p className="text-sm text-slate-500 font-medium">ìš°ë¦¬ ê°€ê²Œ ë§ì¶¤í˜• ì§€ì›ì‚¬ì—… ë§¤ì¹­ì„ ìœ„í•œ ê¸°ì´ˆ ë¦¬í¬íŠ¸</p>
                                </div>
                                <div className="text-right"><p className="text-xl font-black text-[#0055A5] leading-tight mb-1">ë‚´ì¼ì„ ê¿ˆê¾¸ëŠ” ì‚¬ì¥ë‹˜ê»˜</p><p className="text-sm font-bold text-slate-400">ì„œìš¸ì‹ ìš©ë³´ì¦ì¬ë‹¨ ìš©ì‚°ì¢…í•©ì§€ì›ì„¼í„°</p></div>
                            </div>
                        </div>

                        <div className="p-10 space-y-12">
                            {/* [ì¤‘ìš”] ê¸°ì¡´ í†µí•©ë²„ì „18ì˜ ì…ë ¥í¼ ì½”ë“œ 100% ë™ì¼í•˜ê²Œ ìœ ì§€ (ì¸ì‡„ ë ˆì´ì•„ì›ƒ í¬í•¨) */}
                            <section>
                                <div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">1. ê¸°ë³¸ì •ë³´(ëŒ€í‘œì, ì‚¬ì—…ì²´)</h2></div>
                                <div className="info-grid grid grid-cols-1 md:grid-cols-3 gap-y-5 gap-x-8">
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">ì¶œìƒë…„ë„</label><select className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.birthYear} onChange={(e) => setFormData({ ...formData, birthYear: e.target.value })}><option value="">ë…„ë„ ì„ íƒ</option>{years.map(y => <option key={y} value={y}>{y}ë…„</option>)}</select></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">NICE CBì ìˆ˜</label><input type="number" placeholder="ì ìˆ˜ ì…ë ¥" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.niceScore} onChange={(e) => setFormData({ ...formData, niceScore: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">ê¸°ë³´ì¦ê¸ˆì•¡ (ë§Œì›)</label><input type="number" placeholder="ê¸ˆì•¡ ì…ë ¥" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.guaranteedAmount} onChange={(e) => setFormData({ ...formData, guaranteedAmount: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">ì„¤ë¦½ì¼ì</label><input type="date" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.foundationDate} onChange={(e) => setFormData({ ...formData, foundationDate: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">ì—…ì¢…</label><input type="text" placeholder="ì—…ì¢… ì…ë ¥" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.sector} onChange={(e) => setFormData({ ...formData, sector: e.target.value })} /></div>
                                    <div className="space-y-1.5"><label className="text-sm font-black text-slate-500 ml-1">ì¢…ì—…ì›ìˆ˜ (ëª…)</label><input type="number" placeholder="ì¸ì› ìˆ˜" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-sm outline-none text-base font-bold" value={formData.employeeCount} onChange={(e) => setFormData({ ...formData, employeeCount: e.target.value })} /></div>
                                </div>
                                <div className="revenue-box mt-8 flex flex-wrap items-center gap-10 p-5 bg-slate-50 rounded-sm border border-slate-100">
                                    <div className="flex items-center gap-4">
                                        <span className="text-sm font-black text-slate-500 uppercase tracking-tighter">ë§¤ì¶œí˜„í™© :</span>
                                        <div className="flex items-center gap-2">
                                            <input type="number" placeholder="ì‹ ê³ ë§¤ì¶œì•¡ ì…ë ¥" className="w-40 p-2.5 bg-white border border-slate-200 rounded-sm outline-none text-base font-bold text-right focus:ring-1 focus:ring-[#0055A5]" value={formData.annualSales} onChange={(e) => setFormData({ ...formData, annualSales: e.target.value })} />
                                            <span className="text-xs font-bold text-slate-500">ë§Œì›/ë…„</span>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-5">
                                        {["ì§€ì†ì ì¸ ê°ì†Œ", "ê°ì†Œ í›„ ì •ì²´", "í˜„ìƒìœ ì§€", "ì¦ê°€ í›„ ì •ì²´", "ì§€ì†ì ì¸ ì¦ê°€"].map((opt) => (
                                            <label key={opt} className="flex items-center gap-2 cursor-pointer group"><input type="radio" name="revenue" className="w-4 h-4 accent-[#0055A5]" checked={formData.revenueStatus === opt} onChange={() => setFormData({ ...formData, revenueStatus: opt })} /><span className={`text-sm font-bold ${formData.revenueStatus === opt ? 'text-[#0055A5]' : 'text-slate-500'}`}>{opt}</span></label>
                                        ))}
                                    </div>
                                </div>
                            </section>

                            <section>
                                <div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">2. ì‚¬ì—…ìš´ì˜ ì£¼ìš” í˜„í™©</h2></div>
                                <div className="legend-box mb-5 flex flex-wrap gap-5 bg-blue-50/50 p-4 border border-blue-100/50 rounded-sm shadow-sm"><div className="w-full no-print-bg"><span className="text-xs font-black text-[#0055A5] uppercase tracking-widest underline decoration-blue-200 underline-offset-4">ì§„ë‹¨ ì§€í‘œ ì²™ë„ ì•ˆë‚´ (1~4ì )</span></div><div className="flex gap-6"><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">1:</b> ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">2:</b> ê·¸ë ‡ì§€ ì•Šë‹¤</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">3:</b> ê·¸ë ‡ë‹¤</span><span className="text-sm font-bold text-slate-700"><b className="text-[#0055A5]">4:</b> ë§¤ìš° ê·¸ë ‡ë‹¤</span></div></div>
                                <div className="overflow-x-auto border-t-2 border-slate-800">
                                    <table className="w-full border-collapse">
                                        <thead><tr className="bg-slate-50 text-xs font-black text-slate-500 border-b border-slate-200"><th className="p-4 text-center w-28 text-center-print">êµ¬ë¶„</th><th className="p-4 text-center text-center-print">ì§„ë‹¨ë¬¸í•­</th> {[1, 2, 3, 4].map(n => <th key={n} className="p-4 text-center w-16">{n}</th>)}</tr></thead>
                                        <tbody>
                                            {categories.map((cat) => (
                                                <React.Fragment key={cat.name}>
                                                    {questions.slice(cat.startIdx, cat.startIdx + cat.count).map((q, qIdx) => (
                                                        <tr key={q} className="border-b border-slate-100 hover:bg-slate-50/30 transition-colors">
                                                            {qIdx === 0 && (<td rowSpan={cat.count} className="p-4 align-middle font-black text-sm text-[#0055A5] border-r border-slate-100 bg-slate-50/20 text-center text-center-print whitespace-pre-wrap">{cat.name === "ë§¤ì¥ ìš´ì˜Â·ê´€ë¦¬" ? <span>ë§¤ì¥ ìš´ì˜Â·<br className="screen-only" />ê´€ë¦¬</span> : cat.name === "ë²•ë¥ Â·ë…¸ë¬´Â·ì„¸ë¬´" ? <span>ë²•ë¥ Â·ë…¸ë¬´Â·<br className="screen-only" />ì„¸ë¬´</span> : cat.name}</td>)}
                                                            <td className="p-4 text-base text-slate-700 font-medium leading-snug text-center-print">{q}</td>
                                                            {[1, 2, 3, 4].map(score => (<td key={score} className="p-4 text-center"><button onClick={() => handleScoreChange(cat.startIdx + qIdx, score)} className={`w-9 h-9 rounded-sm border transition-all text-sm font-black ${formData.scores[cat.startIdx + qIdx] === score ? 'bg-[#0055A5] border-[#0055A5] text-white shadow-md' : 'bg-white border-slate-200 text-slate-300 hover:border-slate-400 hover:text-slate-500'}`}>{score}</button></td>))}
                                                        </tr>
                                                    ))}
                                                </React.Fragment>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </section>

                            <div className="bottom-grid grid grid-cols-1 md:grid-cols-2 gap-10 items-stretch">
                                <section className="flex flex-col"><div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">3. ìš°ëŒ€ì‚¬í•­ ì²´í¬</h2></div><div className="benefit-grid space-y-1.5">{benefitOptions.map(item => (<label key={item.key} className={`flex items-start gap-3 px-4 py-2.5 rounded-sm border transition-all cursor-pointer group ${formData.benefits[item.key] ? 'bg-blue-50 border-blue-200' : 'bg-white border-slate-100 hover:bg-slate-50'}`}><input type="checkbox" className="mt-0.5 w-5 h-5 accent-[#0055A5]" checked={formData.benefits[item.key]} onChange={() => toggleBenefit(item.key)} /><span className="text-sm font-bold leading-tight group-hover:text-slate-900 transition-colors"><span className={`${formData.benefits[item.key] ? 'text-[#0055A5]' : 'text-slate-600'} screen-only`}>{item.label}</span><span className={`${formData.benefits[item.key] ? 'text-[#0055A5]' : 'text-slate-600'} print-only`}>{item.label.split('(')[0].trim()}</span></span></label>))}</div></section>
                                <section className="flex flex-col"><div className="flex items-center gap-2 mb-4"><div className="w-1.5 h-6 bg-[#0055A5]"></div><h2 className="text-xl font-black text-slate-800 uppercase tracking-tight">â€» ê¸°íƒ€ ì• ë¡œì‚¬í•­</h2></div><textarea className="notes-area w-full flex-grow p-5 border border-slate-200 rounded-sm text-base bg-slate-50/50 focus:ring-1 focus:ring-[#0055A5] outline-none resize-none font-medium leading-relaxed placeholder:text-slate-300" placeholder="êµ¬ì²´ì ì¸ ê³ ë¯¼ì´ë‚˜ ì§€ì›ì´ ì‹œê¸‰í•œ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ê¸°ë¡í•˜ì„¸ìš”." value={formData.notes} onChange={(e) => setFormData({ ...formData, notes: e.target.value })} /></section>
                            </div>

                            <div className="flex justify-between items-center pt-10 border-t border-slate-200 no-print">
                                <button onClick={() => setFormData({ ...formData, scores: Array(11).fill(0), notes: '', benefits: Object.fromEntries(Object.keys(formData.benefits).map(k => [k, false])) })} className="flex items-center gap-2 text-slate-400 hover:text-red-500 font-black text-sm transition-colors"><Icon name="rotate-ccw" size={16} /> ë¦¬ì…‹í•˜ê¸°</button>
                                <div className="flex gap-4">
                                    <button onClick={runRealAIAnalysis} disabled={isAnalyzing} className={`flex items-center gap-3 px-8 py-4 bg-emerald-600 text-white rounded-sm font-black shadow-xl hover:bg-emerald-700 transition-all text-lg ${isAnalyzing ? 'opacity-50' : ''}`}><Icon name={isAnalyzing ? "loader-2" : "sparkles"} size={22} className={isAnalyzing ? "animate-spin" : ""} />{isAnalyzing ? analysisStatus : "AI ì§„ë‹¨ ì‹œì‘"}</button>
                                    <button onClick={() => window.print()} className="flex items-center gap-3 px-10 py-4 bg-[#0055A5] text-white rounded-sm font-black shadow-xl hover:bg-[#004488] transition-all transform active:scale-95 text-lg"><Icon name="printer" size={22} /> ì„¤ë¬¸ì§€ ì¸ì‡„</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>